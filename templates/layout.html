<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>{% block title %}NexStock - Inventory Management System{% endblock %}</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    
    <!-- Tailwind CSS Local Build -->
    <link href="/static/tailwind.css?v={{ cache_buster }}" rel="stylesheet" id="tailwind-local">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css?v={{ cache_buster }}">
    
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Essential styles only - Tailwind handles the rest */
        body { font-family: 'Inter', sans-serif; }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            /* Sidebar overlay on mobile */
            #sidebar {
                position: fixed;
                top: 0;
                left: 0;
                z-index: 50;
                height: 100vh;
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
            }
            #sidebar.sidebar-visible {
                transform: translateX(0);
                box-shadow: 2px 0 8px rgba(0, 0, 0, 0.15);
            }
            /* Backdrop for sidebar */
            #sidebar-backdrop {
                position: fixed;
                inset: 0;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 40;
                display: none;
                transition: opacity 0.3s ease-in-out;
            }
            #sidebar-backdrop.active {
                display: block;
            }
            /* Better touch targets on mobile */
            button, a, input, select, textarea {
                min-height: 44px;
            }
            /* Prevent horizontal scroll */
            body {
                overflow-x: hidden;
            }
            /* Compact table cells */
            td, th {
                padding: 0.5rem !important;
                font-size: 0.75rem !important;
            }
            /* Better form inputs on mobile */
            input[type="text"], 
            input[type="number"], 
            input[type="date"], 
            select {
                font-size: 16px !important; /* Prevents zoom on iOS */
            }
            /* Stack buttons vertically when needed */
            .mobile-stack-buttons {
                flex-direction: column;
                width: 100%;
            }
            .mobile-stack-buttons button {
                width: 100%;
            }
        }
        
        /* Tablet optimizations */
        @media (min-width: 768px) and (max-width: 1024px) {
            /* Optimize for tablet sizes */
            .container {
                max-width: 100%;
                padding-left: 1rem;
                padding-right: 1rem;
            }
        }
        
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
        
        /* Touch feedback */
        @media (hover: none) {
            button:active, a:active {
                opacity: 0.7;
                transform: scale(0.98);
            }
        }
        
        /* Sidebar transition for desktop */
        .sidebar-transition { transition: transform 0.3s ease-in-out; }
        
        /* Numerro Theme Colors */
        .numerro-bg { background-color: #F6F8FC; }
        .numerro-text-primary { color: #252423; }
        .numerro-text-secondary { color: #717A90; }
        .numerro-blue { color: #4E7CFF; }
        .numerro-purple { color: #7033FF; }
        .numerro-red { color: #F65164; }
        .numerro-cyan { color: #22C0FF; }
        .numerro-orange { color: #DC7653; }
        .numerro-border { border-color: #B4BAC3; }
        .numerro-bg-blue { background-color: rgba(78, 124, 255, 0.1); }
        .numerro-bg-purple { background-color: rgba(112, 51, 255, 0.1); }
        .numerro-bg-red { background-color: rgba(246, 81, 100, 0.1); }
        .numerro-bg-cyan { background-color: rgba(34, 192, 255, 0.1); }
        .numerro-bg-orange { background-color: rgba(220, 118, 83, 0.1); }
        .numerro-border-blue { border-color: #4E7CFF; }
        .numerro-border-purple { border-color: #7033FF; }
        .numerro-border-red { border-color: #F65164; }
        .numerro-border-orange { border-color: #DC7653; }
        .numerro-border-neutral { border-color: #B4BAC3; }
        
        /* Responsive utilities */
        .mobile-hide { display: block; }
        .mobile-show { display: none; }
        
        @media (max-width: 768px) {
            .mobile-hide { display: none !important; }
            .mobile-show { display: block !important; }
        }
        
        /* Safe area for notched devices */
        @supports (padding: max(0px)) {
            body {
                padding-left: max(0px, env(safe-area-inset-left));
                padding-right: max(0px, env(safe-area-inset-right));
            }
        }
    </style>
</head>
<body class="numerro-bg numerro-text-primary">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar Backdrop (mobile only) -->
        <div id="sidebar-backdrop"></div>
        
        <!-- Sidebar -->
    <div id="sidebar" class="bg-white w-64 md:w-64 min-h-screen shadow-lg sidebar-transition flex flex-col border-r numerro-border" style="border-radius:0">
            <!-- Logo -->
            <div class="p-6 border-b border-gray-200" style="border-radius:0">
                <a href="/" class="flex items-center space-x-3 hover:opacity-80 transition-opacity">
                    <div class="w-10 h-10 flex items-center justify-center" style="background-color: #4E7CFF; border-radius: 0;">
                        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="NexStock Logo" class="w-7 h-7" style="filter: brightness(0) invert(1);">
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold" style="color: #252423;">NexStock</h1>
                        <p class="text-sm" style="color: #22C0FF;">Inventory Management</p>
                    </div>
                </a>
            </div>
            
            <!-- Navigation -->
            <nav class="flex-1 px-4 py-6 space-y-2">
                <!-- Operations -->
                <div class="mb-6">
                    <h3 class="text-xs uppercase tracking-wider text-primary-500 font-semibold mb-3 px-3">Operations</h3>
                    <a href="/" class="flex items-center px-3 py-2.5 text-sm font-medium text-slate-800 hover:bg-slate-100 transition-colors group" style="border-radius:0">
                        <i class="fas fa-home w-5 h-5 mr-3 text-slate-400"></i>
                        Dashboard
                    </a>
                    <a href="/inventory" class="flex items-center px-3 py-2.5 text-sm font-medium text-slate-800 hover:bg-slate-100 transition-colors group" style="border-radius:0">
                        <i class="fas fa-boxes w-5 h-5 mr-3 text-slate-400"></i>
                        Inventory
                    </a>
                    <a href="/transactions" class="flex items-center px-3 py-2.5 text-sm font-medium text-slate-800 hover:bg-slate-100 transition-colors group" style="border-radius:0">
                        <i class="fas fa-exchange-alt w-5 h-5 mr-3 text-slate-400"></i>
                        Transactions
                    </a>
                    <a href="/portafolio" class="flex items-center px-3 py-2.5 text-sm font-medium text-slate-800 hover:bg-slate-100 transition-colors group" style="border-radius:0">
                        <i class="fas fa-briefcase w-5 h-5 mr-3 text-slate-400"></i>
                        Portfolio
                    </a>
                </div>
                
                <!-- Analysis -->
                <div class="mb-6">
                    <h3 class="text-xs uppercase tracking-wider numerro-text-secondary font-semibold mb-3 px-3">Analysis</h3>
                    <a href="/analytics" class="flex items-center px-3 py-2.5 text-sm font-medium numerro-text-primary hover:bg-slate-100 transition-colors group" style="border-radius:0">
                        <i class="fas fa-chart-bar w-5 h-5 mr-3 numerro-text-secondary"></i>
                        Analytics
                    </a>
                    <a href="/forecast" class="flex items-center px-3 py-2.5 text-sm font-medium numerro-text-primary hover:bg-slate-100 transition-colors group" style="border-radius:0">
                        <i class="fas fa-brain w-5 h-5 mr-3 numerro-text-secondary"></i>
                        Forecast
                    </a>
                    <a href="/optimize" class="flex items-center px-3 py-2.5 text-sm font-medium numerro-text-primary hover:bg-slate-100 transition-colors group" style="border-radius:0">
                        <i class="fas fa-cogs w-5 h-5 mr-3 numerro-text-secondary"></i>
                        Optimization
                    </a>
                    <a href="/results" class="flex items-center px-3 py-2.5 text-sm font-medium numerro-text-primary hover:bg-slate-100 transition-colors group" style="border-radius:0">
                        <i class="fas fa-chart-pie w-5 h-5 mr-3 numerro-text-secondary"></i>
                        Results
                    </a>
                </div>
                
                <!-- Tools -->
                <div class="mb-6">
                    <h3 class="text-xs uppercase tracking-wider numerro-text-secondary font-semibold mb-3 px-3">Tools</h3>
                    <a href="/alerts" class="flex items-center px-3 py-2.5 text-sm font-medium text-slate-800 hover:bg-slate-100 transition-colors group" style="border-radius:0">
                        <i class="fas fa-bell w-5 h-5 mr-3 text-slate-400"></i>
                        Alerts
                    </a>
                    <a href="/barcode" class="flex items-center px-3 py-2.5 text-sm font-medium text-slate-800 hover:bg-slate-100 transition-colors group" style="border-radius:0">
                        <i class="fas fa-barcode w-5 h-5 mr-3 text-slate-400"></i>
                        Barcode Scanner
                    </a>
                    <a href="/import_export" class="flex items-center px-3 py-2.5 text-sm font-medium text-slate-800 hover:bg-slate-100 transition-colors group" style="border-radius:0">
                        <i class="fas fa-file-export w-5 h-5 mr-3 text-slate-400"></i>
                        Import/Export
                    </a>
                </div>
            </nav>
            
            <!-- Footer -->
            <div class="p-4 border-t border-gray-200">
                <div class="text-xs text-primary-500 text-center">
                    Â© 2025 NexStock Pro
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Header -->
            <header class="bg-white shadow-sm numerro-border px-4 md:px-6 py-3 md:py-4" style="border-bottom-width:1px">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2 md:space-x-4 flex-1 min-w-0">
                        <button id="sidebar-toggle" class="md:hidden p-2 hover:bg-gray-100 transition-colors" style="border-radius:0;min-width:44px;min-height:44px">
                            <i class="fas fa-bars numerro-text-primary text-lg"></i>
                        </button>
                        <div class="min-w-0 flex-1">
                            <h2 class="text-xl md:text-2xl font-semibold numerro-text-primary truncate">{% block page_title %}Dashboard{% endblock %}</h2>
                            <p class="text-xs md:text-sm numerro-text-secondary hidden sm:block truncate">{% block page_description %}Main Control Panel{% endblock %}</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-2 md:space-x-4 flex-shrink-0">
                        <div class="text-xs md:text-sm numerro-text-secondary hidden sm:flex items-center">
                            <i class="fas fa-clock mr-1"></i>
                            <span id="current-time"></span>
                        </div>
                        <div class="w-8 h-8 md:w-9 md:h-9 flex items-center justify-center" style="background-color:#4E7CFF;border-radius:0">
                            <i class="fas fa-user text-white text-xs md:text-sm"></i>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Page Content -->
            <main class="flex-1 overflow-y-auto numerro-bg p-3 md:p-6">
                <div class="max-w-7xl mx-auto">
                    {% block main %}{% endblock %}
                </div>
            </main>
        </div>
    </div>
    
    <!-- Scripts -->
    <script>
        // Sidebar toggle for mobile
        const sidebar = document.getElementById('sidebar');
        const sidebarBackdrop = document.getElementById('sidebar-backdrop');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        
        sidebarToggle.addEventListener('click', function(e) {
            e.stopPropagation();
            sidebar.classList.toggle('sidebar-visible');
            sidebarBackdrop.classList.toggle('active');
        });
        
        // Close sidebar when clicking backdrop
        sidebarBackdrop.addEventListener('click', function() {
            sidebar.classList.remove('sidebar-visible');
            sidebarBackdrop.classList.remove('active');
        });
        
        // Update current time
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES', { 
                hour: '2-digit', 
                minute: '2-digit'
            });
            document.getElementById('current-time').textContent = timeString;
        }
        
        updateTime();
        setInterval(updateTime, 60000); // Update every minute
        
        // Close sidebar on mobile when clicking a navigation link
        document.querySelectorAll('#sidebar a').forEach(link => {
            link.addEventListener('click', function() {
                if (window.innerWidth < 768) {
                    sidebar.classList.remove('sidebar-visible');
                    sidebarBackdrop.classList.remove('active');
                }
            });
        });
        
        // Debug helper - show CSS status
        console.log('Cache buster:', '{{ cache_buster }}');
        console.log('Tailwind CSS local loaded from: /static/tailwind.css');
        console.log('CDN Tailwind should NOT be loaded (using local build)');
        
        // Check if CSS loaded successfully
        document.addEventListener('DOMContentLoaded', function() {
            const cssLinks = document.querySelectorAll('link[rel="stylesheet"]');
            cssLinks.forEach((link, index) => {
                link.addEventListener('load', function() {
                    console.log(`CSS ${index + 1} loaded successfully:`, this.href);
                });
                link.addEventListener('error', function() {
                    console.error(`Failed to load CSS ${index + 1}:`, this.href);
                });
            });
        });
    </script>
    
    <!-- Page-specific scripts -->
    {% block scripts %}{% endblock %}
</body>
</html>
