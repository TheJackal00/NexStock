{% extends "layout.html" %}

{% block title %}Import & Export - NexStock{% endblock %}

{% block page_title %}Import & Export Data{% endblock %}
{% block page_description %}Manage data transfer with CSV file imports and exports{% endblock %}

{% block main %}
<div class="space-y-6">
    <!-- Header with Actions -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
        <div>
            <h1 class="text-2xl font-bold numerro-text-primary">ðŸ”„ Import & Export Data</h1>
            <p class="mt-2 text-sm numerro-text-secondary">Manage data transfer with CSV file imports and exports</p>
        </div>
        <div class="mt-4 sm:mt-0 flex space-x-3">
            <button 
                type="button" 
                onclick="refreshData()"
                class="inline-flex items-center px-4 py-2 numerro-border text-sm font-medium numerro-text-primary bg-white focus:outline-none transition-colors" style="border-radius:0; border-width:1px;" onmouseover="this.style.background='#F6F8FC'" onmouseout="this.style.background='#FFFFFF'">
                <i class="fas fa-sync-alt mr-2"></i>
                Refresh
            </button>
            <button 
                type="button" 
                onclick="showHelp()"
                class="inline-flex items-center px-4 py-2 shadow-sm text-sm font-medium text-white focus:outline-none transition-colors" style="background:#4E7CFF; border-radius:0; border:none;" onmouseover="this.style.background='#3D63CC'" onmouseout="this.style.background='#4E7CFF'">
                <i class="fas fa-question-circle mr-2"></i>
                Help
            </button>
        </div>
    </div>

    <!-- Export Section -->
    <div class="bg-white shadow-sm numerro-border" style="border-radius:0; border-width:1px;">
        <div class="px-6 py-4 numerro-border" style="border-bottom-width:1px;">
            <h3 class="text-lg font-medium numerro-text-primary">Export Data</h3>
            <p class="mt-1 text-sm numerro-text-secondary">Download your data in CSV format</p>
        </div>
    
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="numerro-border p-6 transition-colors" style="background:#F6F8FC; border-radius:0; border-width:1px;" onmouseover="this.style.background='#EBEEF5'" onmouseout="this.style.background='#F6F8FC'">
                    <div class="text-center">
                        <div class="w-12 h-12 flex items-center justify-center mx-auto mb-4" style="background:#4E7CFF; border-radius:0;">
                            <i class="fas fa-warehouse text-xl text-white"></i>
                        </div>
                        <h3 class="text-lg font-semibold numerro-text-primary mb-2">Inventory Export</h3>
                        <p class="numerro-text-secondary text-sm mb-4">Export current inventory levels with product information</p>
                        <button onclick="exportData('inventory')" 
                                class="w-full px-4 py-2 text-white font-medium text-sm transition-colors" style="background:#4E7CFF; border-radius:0; border:none;" onmouseover="this.style.background='#3D63CC'" onmouseout="this.style.background='#4E7CFF'">
                            <i class="fas fa-download mr-2"></i>
                            Export Inventory
                        </button>
                    </div>
                </div>

                <div class="numerro-border p-6 transition-colors" style="background:#F6F8FC; border-radius:0; border-width:1px;" onmouseover="this.style.background='#EBEEF5'" onmouseout="this.style.background='#F6F8FC'">
                    <div class="text-center">
                        <div class="w-12 h-12 flex items-center justify-center mx-auto mb-4" style="background:#22C0FF; border-radius:0;">
                            <i class="fas fa-exchange-alt text-xl text-white"></i>
                        </div>
                        <h3 class="text-lg font-semibold numerro-text-primary mb-2">Transactions Export</h3>
                        <p class="numerro-text-secondary text-sm mb-4">Export complete transaction history with timestamps</p>
                        <button onclick="exportData('transactions')" 
                                class="w-full px-4 py-2 text-white font-medium text-sm transition-colors" style="background:#22C0FF; border-radius:0; border:none;" onmouseover="this.style.background='#1BA3D9'" onmouseout="this.style.background='#22C0FF'">
                            <i class="fas fa-download mr-2"></i>
                            Export Transactions
                        </button>
                    </div>
                </div>

                <div class="numerro-border p-6 transition-colors" style="background:#F6F8FC; border-radius:0; border-width:1px;" onmouseover="this.style.background='#EBEEF5'" onmouseout="this.style.background='#F6F8FC'">
                    <div class="text-center">
                        <div class="w-12 h-12 flex items-center justify-center mx-auto mb-4" style="background:#7033FF; border-radius:0;">
                            <i class="fas fa-chart-bar text-xl text-white"></i>
                        </div>
                        <h3 class="text-lg font-semibold numerro-text-primary mb-2">Analytics Report</h3>
                        <p class="numerro-text-secondary text-sm mb-4">Export comprehensive analytics with performance metrics</p>
                        <button onclick="exportData('analytics')" 
                                class="w-full px-4 py-2 text-white font-medium text-sm transition-colors" style="background:#7033FF; border-radius:0; border:none;" onmouseover="this.style.background='#5A29CC'" onmouseout="this.style.background='#7033FF'">
                            <i class="fas fa-download mr-2"></i>
                            Export Analytics
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Section -->
    <div class="bg-white shadow-sm numerro-border" style="border-radius:0; border-width:1px;">
        <div class="px-6 py-4 numerro-border" style="border-bottom-width:1px;">
            <h3 class="text-lg font-medium numerro-text-primary">Import Data</h3>
            <p class="mt-1 text-sm numerro-text-secondary">Upload CSV files to update your data</p>
        </div>
    
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="numerro-border p-6" style="background:#F6F8FC; border-radius:0; border-width:1px;">
                    <div class="flex items-center space-x-2 mb-4">
                        <div class="w-8 h-8 flex items-center justify-center" style="background:#4E7CFF; border-radius:0;">
                            <i class="fas fa-boxes text-white text-sm"></i>
                        </div>
                        <h3 class="text-lg font-semibold numerro-text-primary">Import Inventory</h3>
                    </div>
                    <p class="numerro-text-secondary mb-4">Update inventory levels from CSV file</p>
                    
                    <div class="mb-4">
                        <button onclick="downloadTemplate('inventory')" 
                                class="px-3 py-2 bg-white numerro-text-primary text-sm font-medium transition-colors numerro-border" style="border-radius:0; border-width:1px;" onmouseover="this.style.background='#F6F8FC'" onmouseout="this.style.background='#FFFFFF'">
                            <i class="fas fa-file-csv mr-2"></i>
                            Download Template
                        </button>
                    </div>
                    
                    <form id="inventory-import-form" enctype="multipart/form-data" class="space-y-4">
                        <div>
                            <label for="inventory-file" class="block text-sm font-medium numerro-text-primary mb-2">Select CSV File:</label>
                            <input type="file" id="inventory-file" accept=".csv" required
                                   class="block w-full text-sm numerro-text-secondary file:mr-4 file:py-2 file:px-4 file:border-0 file:text-sm file:font-medium file:text-white file:transition-colors numerro-border" style="border-radius:0; border-width:1px; file:background:#4E7CFF;">
                        </div>
                        <button type="submit" class="w-full px-4 py-2 text-white font-medium text-sm transition-colors" style="background:#4E7CFF; border-radius:0; border:none;" onmouseover="this.style.background='#3D63CC'" onmouseout="this.style.background='#4E7CFF'">
                            <i class="fas fa-upload mr-2"></i>
                            Import Inventory
                        </button>
                    </form>
                </div>

                <div class="numerro-border p-6" style="background:#F6F8FC; border-radius:0; border-width:1px;">
                    <div class="flex items-center space-x-2 mb-4">
                        <div class="w-8 h-8 flex items-center justify-center" style="background:#22C0FF; border-radius:0;">
                            <i class="fas fa-tags text-white text-sm"></i>
                        </div>
                        <h3 class="text-lg font-semibold numerro-text-primary">Import Products</h3>
                    </div>
                    <p class="numerro-text-secondary mb-4">Add or update product information from CSV file</p>
                    
                    <div class="mb-4">
                        <button onclick="downloadTemplate('products')" 
                                class="px-3 py-2 bg-white numerro-text-primary text-sm font-medium transition-colors numerro-border" style="border-radius:0; border-width:1px;" onmouseover="this.style.background='#F6F8FC'" onmouseout="this.style.background='#FFFFFF'">
                            <i class="fas fa-file-csv mr-2"></i>
                            Download Template
                        </button>
                    </div>
                    
                    <form id="products-import-form" enctype="multipart/form-data" class="space-y-4">
                        <div>
                            <label for="products-file" class="block text-sm font-medium numerro-text-primary mb-2">Select CSV File:</label>
                            <input type="file" id="products-file" accept=".csv" required
                                   class="block w-full text-sm numerro-text-secondary file:mr-4 file:py-2 file:px-4 file:border-0 file:text-sm file:font-medium file:text-white file:transition-colors numerro-border" style="border-radius:0; border-width:1px; file:background:#22C0FF;">
                        </div>
                        <button type="submit" class="w-full px-4 py-2 text-white font-medium text-sm transition-colors" style="background:#22C0FF; border-radius:0; border:none;" onmouseover="this.style.background='#1BA3D9'" onmouseout="this.style.background='#22C0FF'">
                            <i class="fas fa-upload mr-2"></i>
                            Import Products
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Results -->
    <div id="import-results" class="hidden">
        <div class="bg-white shadow-sm numerro-border" style="border-radius:0; border-width:1px;">
            <div class="px-6 py-4 numerro-border" style="border-bottom-width:1px;">
                <h3 class="text-lg font-medium numerro-text-primary">Import Results</h3>
            </div>
            <div class="p-6">
                <div id="import-results-content">
                    <!-- Results will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Data Format Guide -->
    <div class="bg-white shadow-sm numerro-border" style="border-radius:0; border-width:1px;">
        <div class="px-6 py-4 numerro-border" style="border-bottom-width:1px;">
            <h3 class="text-lg font-medium numerro-text-primary">Data Format Guide</h3>
        </div>
        
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold numerro-text-primary mb-4 flex items-center">
                        <div class="w-6 h-6 mr-2 flex items-center justify-center" style="background:#4E7CFF; border-radius:0;">
                            <i class="fas fa-table text-white text-xs"></i>
                        </div>
                        Inventory CSV Format
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full numerro-border" style="border-radius:0; border-width:1px;">
                            <thead style="background:#F6F8FC;">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium numerro-text-secondary uppercase tracking-wider">Column</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium numerro-text-secondary uppercase tracking-wider">Required</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium numerro-text-secondary uppercase tracking-wider">Description</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white">
                                <tr style="border-top:1px solid #B4BAC3;">
                                    <td class="px-4 py-3 text-sm font-mono numerro-text-primary" style="background:#F6F8FC;">SKU</td>
                                    <td class="px-4 py-3 text-sm">
                                        <span class="px-2 py-1 text-xs font-medium text-white" style="background:#F65164; border-radius:0;">
                                            Required
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-sm numerro-text-secondary">Product identifier (text)</td>
                                </tr>
                                <tr style="border-top:1px solid #B4BAC3;">
                                    <td class="px-4 py-3 text-sm font-mono numerro-text-primary" style="background:#F6F8FC;">VOLUME</td>
                                    <td class="px-4 py-3 text-sm">
                                        <span class="px-2 py-1 text-xs font-medium text-white" style="background:#F65164; border-radius:0;">
                                            Required
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-sm numerro-text-secondary">Stock quantity (numeric)</td>
                                </tr>
                                <tr style="border-top:1px solid #B4BAC3;">
                                    <td class="px-4 py-3 text-sm font-mono numerro-text-primary" style="background:#F6F8FC;">DATE</td>
                                    <td class="px-4 py-3 text-sm">
                                        <span class="px-2 py-1 text-xs font-medium numerro-text-secondary" style="background:#F6F8FC; border-radius:0;">
                                            Optional
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-sm numerro-text-secondary">Inventory date (YYYY-MM-DD format)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="numerro-border p-3 mt-4" style="background:rgba(78,124,255,0.1); border-radius:0; border-width:1px;">
                        <p class="text-sm" style="color:#4E7CFF;">
                            <i class="fas fa-info-circle mr-2"></i>
                            <strong>Note:</strong> If DATE is not provided, current date will be used automatically.
                        </p>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg font-semibold numerro-text-primary mb-4 flex items-center">
                        <div class="w-6 h-6 mr-2 flex items-center justify-center" style="background:#22C0FF; border-radius:0;">
                            <i class="fas fa-table text-white text-xs"></i>
                        </div>
                        Products CSV Format
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full numerro-border" style="border-radius:0; border-width:1px;">
                            <thead style="background:#F6F8FC;">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium numerro-text-secondary uppercase tracking-wider">Column</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium numerro-text-secondary uppercase tracking-wider">Required</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium numerro-text-secondary uppercase tracking-wider">Description</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white">
                                <tr style="border-top:1px solid #B4BAC3;">
                                    <td class="px-4 py-3 text-sm font-mono numerro-text-primary" style="background:#F6F8FC;">SKU</td>
                                    <td class="px-4 py-3 text-sm">
                                        <span class="px-2 py-1 text-xs font-medium text-white" style="background:#F65164; border-radius:0;">
                                            Required
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-sm numerro-text-secondary">Product identifier (text)</td>
                                </tr>
                                <tr style="border-top:1px solid #B4BAC3;">
                                    <td class="px-4 py-3 text-sm font-mono numerro-text-primary" style="background:#F6F8FC;">NAME</td>
                                    <td class="px-4 py-3 text-sm">
                                        <span class="px-2 py-1 text-xs font-medium numerro-text-secondary" style="background:#F6F8FC; border-radius:0;">
                                            Optional
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-sm numerro-text-secondary">Product name (text)</td>
                                </tr>
                                <tr style="border-top:1px solid #B4BAC3;">
                                    <td class="px-4 py-3 text-sm font-mono numerro-text-primary" style="background:#F6F8FC;">COST</td>
                                    <td class="px-4 py-3 text-sm">
                                        <span class="px-2 py-1 text-xs font-medium numerro-text-secondary" style="background:#F6F8FC; border-radius:0;">
                                            Optional
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-sm text-gray-600">Unit cost (numeric, decimal allowed)</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3 text-sm font-mono text-gray-800 bg-gray-50">MARGIN</td>
                                    <td class="px-4 py-3 text-sm">
                                        <span class="px-2 py-1 text-xs font-medium bg-gray-400 text-white" style="border-radius:0">
                                            Optional
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-sm text-gray-600">Profit margin as decimal (0.15 = 15%)</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3 text-sm font-mono text-gray-800 bg-gray-50">EXPIRATION</td>
                                    <td class="px-4 py-3 text-sm">
                                        <span class="px-2 py-1 text-xs font-medium bg-gray-400 text-white" style="border-radius:0">
                                            Optional
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-sm text-gray-600">Days until expiration (integer)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="numerro-border p-3 mt-4" style="background:rgba(34,192,255,0.1); border-radius:0; border-width:1px;">
                        <p class="text-sm" style="color:#22C0FF;">
                            <i class="fas fa-info-circle mr-2"></i>
                            <strong>Note:</strong> Optional fields will use default values if not provided.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Additional Format Information -->
    <div class="bg-white shadow-sm border border-gray-200" style="border-radius:0">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">Export Formats Reference</h3>
        </div>
        
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-gray-50 border border-gray-200 p-4" style="border-radius:0">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Inventory Export</h3>
                    <p class="text-sm text-gray-600">
                        Includes: SKU, VOLUME, DATE<br>
                        Shows current stock levels with latest inventory dates
                    </p>
                </div>
                <div class="bg-slate-50 border border-slate-200 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-slate-800 mb-2">Transactions Export</h3>
                    <p class="text-sm text-slate-600">
                        Includes: SKU, VOLUME, DOCUMENT_TYPE, DOC_NUMBER, DATE<br>
                        Complete transaction history with document references
                    </p>
                </div>
                <div class="bg-slate-50 border border-slate-200 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-slate-800 mb-2">Analytics Export</h3>
                    <p class="text-sm text-slate-600">
                        Includes: SKU, demand statistics, turnover ratios<br>
                        Performance metrics and analysis data
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Sample Data Examples -->
    <div class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden">
        <div class="bg-slate-50 border-b border-slate-200 px-6 py-4">
            <h2 class="text-xl font-semibold text-slate-900">Sample CSV Data</h2>
        </div>
        
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-slate-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-slate-800 mb-3">Inventory CSV Example</h3>
                    <pre class="text-xs bg-white p-3 rounded border text-slate-700 overflow-x-auto">SKU,VOLUME,DATE
001,150,2024-10-22
002,75,2024-10-22
003,200,2024-10-21
004,50,2024-10-22
005,125,2024-10-22</pre>
                </div>
                <div class="bg-slate-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-slate-800 mb-3">Products CSV Example</h3>
                    <pre class="text-xs bg-white p-3 rounded border text-slate-700 overflow-x-auto">SKU,NAME,COST,MARGIN,EXPIRATION
001,Wireless Headphones,25.50,0.25,365
002,Smartphone Case,8.00,0.40,730
003,Bluetooth Speaker,45.00,0.20,365
004,USB Cable,3.50,0.60,1095
005,Power Bank,18.00,0.30,365</pre>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Help Modal -->
<div id="helpModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen px-4">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="bg-slate-700 text-white px-6 py-4 rounded-t-lg flex justify-between items-center">
                <h5 class="text-xl font-semibold"><i class="fas fa-info-circle mr-2"></i> Import & Export Help Guide</h5>
                <button type="button" class="text-white hover:text-gray-200" onclick="closeHelpModal()">
                    <span class="text-2xl">&times;</span>
                </button>
            </div>
            <div class="p-6">
                <h6 class="text-lg font-semibold text-slate-700 mb-3"><i class="fas fa-download text-slate-600 mr-2"></i> Export Functions</h6>
                <div class="mb-6">
                    <ul class="space-y-2 text-slate-600">
                        <li><strong class="text-slate-800">Inventory Export:</strong> Downloads current stock levels with volume and dates. Perfect for external reporting or backup purposes.</li>
                        <li><strong class="text-slate-800">Transactions Export:</strong> Downloads complete transaction history including document types and numbers. Useful for auditing and compliance.</li>
                        <li><strong class="text-slate-800">Analytics Report:</strong> Downloads comprehensive performance analytics including demand patterns, turnover ratios, and statistical analysis.</li>
                    </ul>
                </div>
                
                <h6 class="text-lg font-semibold text-slate-700 mb-3"><i class="fas fa-upload text-slate-600 mr-2"></i> Import Functions</h6>
                <div class="mb-6">
                    <ul class="space-y-2 text-slate-600">
                        <li><strong class="text-slate-800">Inventory Import:</strong> Updates stock levels from CSV file. Use when conducting physical inventory counts or bulk stock adjustments.</li>
                        <li><strong class="text-slate-800">Products Import:</strong> Adds new products or updates existing product information including costs, margins, and expiration data.</li>
                    </ul>
                </div>
                
                <h6 class="text-lg font-semibold text-slate-700 mb-3"><i class="fas fa-check-circle text-slate-600 mr-2"></i> Best Practices</h6>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <h6 class="text-base font-medium text-slate-600 mb-2">Before Import:</h6>
                        <ul class="text-sm space-y-1 text-slate-600">
                            <li>Always download and use provided templates</li>
                            <li>Validate data in Excel/spreadsheet software first</li>
                            <li>Check for duplicate SKUs</li>
                            <li>Backup your current data</li>
                            <li>Test with small batches first</li>
                        </ul>
                    </div>
                    <div>
                        <h6 class="text-base font-medium text-slate-600 mb-2">Data Quality:</h6>
                        <ul class="text-sm space-y-1 text-slate-600">
                            <li>Use consistent SKU naming conventions</li>
                            <li>Ensure numeric fields contain valid numbers</li>
                            <li>Use YYYY-MM-DD format for dates</li>
                            <li>Verify products exist before inventory import</li>
                            <li>Check import results carefully</li>
                        </ul>
                    </div>
                </div>
                
                <h6 class="text-lg font-semibold text-slate-700 mb-3"><i class="fas fa-exclamation-triangle text-slate-600 mr-2"></i> Data Format Requirements</h6>
                <div class="bg-slate-50 border border-slate-200 rounded-lg p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <strong class="text-slate-800">Inventory CSV:</strong>
                            <ul class="text-sm space-y-1 text-slate-600 mt-2">
                                <li>SKU (required): Product identifier</li>
                                <li>VOLUME (required): Stock quantity as number</li>
                                <li>DATE (optional): YYYY-MM-DD format</li>
                            </ul>
                        </div>
                        <div>
                            <strong class="text-slate-800">Products CSV:</strong>
                            <ul class="text-sm space-y-1 text-slate-600 mt-2">
                                <li>SKU (required): Product identifier</li>
                                <li>NAME (optional): Product name</li>
                                <li>COST (optional): Unit cost as decimal</li>
                                <li>MARGIN (optional): Profit margin as decimal (0.15 = 15%)</li>
                                <li>EXPIRATION (optional): Days until expiration</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <h6 class="text-lg font-semibold text-slate-700 mb-3"><i class="fas fa-tools text-slate-600 mr-2"></i> Troubleshooting</h6>
                <div class="space-y-3">
                    <div class="border border-slate-200 rounded-lg">
                        <button class="w-full px-4 py-3 text-left bg-slate-50 hover:bg-slate-100 rounded-t-lg focus:outline-none" onclick="toggleAccordion('accordion1')">
                            <strong class="text-slate-800">File Format Issues</strong>
                            <i id="icon1" class="fas fa-chevron-down float-right mt-1 text-slate-500"></i>
                        </button>
                        <div id="accordion1" class="hidden px-4 py-3 bg-white border-t border-slate-200">
                            <ul class="text-sm space-y-1 text-slate-600">
                                <li>Ensure file is saved as .csv format (not .xlsx)</li>
                                <li>Use UTF-8 encoding to prevent character issues</li>
                                <li>Remove any blank rows or columns</li>
                                <li>Check that headers match exactly (case-sensitive)</li>
                            </ul>
                        </div>
                    </div>
                    <div class="border border-slate-200 rounded-lg">
                        <button class="w-full px-4 py-3 text-left bg-slate-50 hover:bg-slate-100 rounded-t-lg focus:outline-none" onclick="toggleAccordion('accordion2')">
                            <strong class="text-slate-800">Data Validation Errors</strong>
                            <i id="icon2" class="fas fa-chevron-down float-right mt-1 text-slate-500"></i>
                        </button>
                        <div id="accordion2" class="hidden px-4 py-3 bg-white border-t border-slate-200">
                            <ul class="text-sm space-y-1 text-slate-600">
                                <li>Remove special characters from SKU fields</li>
                                <li>Verify numeric fields contain only numbers</li>
                                <li>Check date format is YYYY-MM-DD</li>
                                <li>Ensure margin values are decimals (not percentages)</li>
                            </ul>
                        </div>
                    </div>
                    <div class="border border-slate-200 rounded-lg">
                        <button class="w-full px-4 py-3 text-left bg-slate-50 hover:bg-slate-100 rounded-t-lg focus:outline-none" onclick="toggleAccordion('accordion3')">
                            <strong class="text-slate-800">Import Failures</strong>
                            <i id="icon3" class="fas fa-chevron-down float-right mt-1 text-slate-500"></i>
                        </button>
                        <div id="accordion3" class="hidden px-4 py-3 bg-white border-t border-slate-200">
                            <ul class="text-sm space-y-1 text-slate-600">
                                <li>Check file size is under 10MB limit</li>
                                <li>Verify products exist before importing inventory</li>
                                <li>Look for duplicate SKUs in the file</li>
                                <li>Review error messages in import results</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-slate-50 px-6 py-4 rounded-b-lg flex justify-end border-t border-slate-200">
                <button type="button" class="px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-500" onclick="closeHelpModal()">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal and Accordion JavaScript -->

<script>
// Export Functions
function exportData(type) {
    const button = event.target;
    const originalText = button.innerHTML;
    
    // Show loading state
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Exporting...';
    button.disabled = true;
    
    // Create download link
    const link = document.createElement('a');
    link.href = `/api/export/${type}`;
    link.download = `${type}_export.csv`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    // Reset button after short delay
    setTimeout(() => {
        button.innerHTML = originalText;
        button.disabled = false;
    }, 2000);
}

// Template Download
function downloadTemplate(type) {
    const link = document.createElement('a');
    link.href = `/api/template/${type}`;
    link.download = `${type}_template.csv`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// Import Form Handlers
document.getElementById('inventory-import-form').addEventListener('submit', function(e) {
    e.preventDefault();
    importData('inventory');
});

document.getElementById('products-import-form').addEventListener('submit', function(e) {
    e.preventDefault();
    importData('products');
});

function importData(type) {
    const fileInput = document.getElementById(`${type}-file`);
    const file = fileInput.files[0];
    
    if (!file) {
        alert('Please select a file');
        return;
    }
    
    const formData = new FormData();
    formData.append('file', file);
    
    // Show loading state
    const submitBtn = event.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Importing...';
    submitBtn.disabled = true;
    
    fetch(`/api/import/${type}`, {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            showImportResults(false, data.error, []);
            return;
        }
        
        showImportResults(true, data.message, data.failed_imports || []);
        
        // Reset form
        fileInput.value = '';
    })
    .catch(error => {
        console.error('Import error:', error);
        showImportResults(false, 'Import failed: ' + error.message, []);
    })
    .finally(() => {
        // Reset button
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    });
}

function showImportResults(success, message, failures) {
    const resultsDiv = document.getElementById('import-results');
    const contentDiv = document.getElementById('import-results-content');
    
    let html = `
        <div class="${success ? 'bg-slate-100 border-slate-300 text-slate-800' : 'bg-slate-100 border-slate-300 text-slate-800'} border rounded-lg p-4 mb-4" role="alert">
            <h5 class="text-lg font-semibold mb-2"><i class="fas ${success ? 'fa-check-circle' : 'fa-exclamation-triangle'}"></i> Import Results</h5>
            <p class="text-sm">${message}</p>
        </div>
    `;
    
    if (failures.length > 0) {
        html += `
            <div class="bg-slate-100 border-slate-300 text-slate-700 border rounded-lg p-4 mb-4">
                <h6 class="font-semibold mb-2">Failed Imports:</h6>
                <ul class="text-sm pl-5 list-disc">
                    ${failures.map(failure => `<li>${failure}</li>`).join('')}
                </ul>
            </div>
        `;
    }
    
    contentDiv.innerHTML = html;
    resultsDiv.style.display = 'block';
    
    // Scroll to results
    resultsDiv.scrollIntoView({ behavior: 'smooth' });
}

function showHelp() {
    document.getElementById('helpModal').classList.remove('hidden');
}

function closeHelpModal() {
    document.getElementById('helpModal').classList.add('hidden');
}

// Close modal when clicking outside
document.getElementById('helpModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeHelpModal();
    }
});

function toggleAccordion(accordionId) {
    const accordion = document.getElementById(accordionId);
    const icon = document.getElementById('icon' + accordionId.slice(-1));
    
    if (accordion.classList.contains('hidden')) {
        accordion.classList.remove('hidden');
        icon.classList.remove('fa-chevron-down');
        icon.classList.add('fa-chevron-up');
    } else {
        accordion.classList.add('hidden');
        icon.classList.remove('fa-chevron-up');
        icon.classList.add('fa-chevron-down');
    }
}

// File validation
document.getElementById('inventory-file').addEventListener('change', function(e) {
    validateFile(e.target);
});

document.getElementById('products-file').addEventListener('change', function(e) {
    validateFile(e.target);
});

function validateFile(input) {
    const file = input.files[0];
    if (!file) return;
    
    const validTypes = ['text/csv', 'application/vnd.ms-excel'];
    const validExtensions = ['.csv'];
    
    const fileExtension = file.name.toLowerCase().substring(file.name.lastIndexOf('.'));
    
    if (!validExtensions.includes(fileExtension)) {
        alert('Please select a CSV file');
        input.value = '';
        return false;
    }
    
    if (file.size > 10 * 1024 * 1024) { // 10MB limit
        alert('File size must be less than 10MB');
        input.value = '';
        return false;
    }
    
    return true;
}
</script>
{% endblock %}